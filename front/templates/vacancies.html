{% extends "base.html" %}

{% block title %}–°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endblock %}
{% block title_header %}–°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π{% endblock %}

{% block content %}
<style>
    .vacancy-card {
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        padding: 20px;
    }

    .btn-success {
        font-weight: bold;
        font-size: 16px;
    }

    body {
        background-color: #f0f4f7;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    .vacancy-card {
        border-radius: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .vacancy-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .navbar {
        background-color: #e3f2fd;
    }

    .btn-outline-primary {
        color: #007bff;
        border-color: #007bff;
    }

    .btn-outline-primary:hover {
        background-color: #007bff;
        color: #fff;
    }

    .modal-header {
        border-bottom: 1px solid #dee2e6;
    }

    .form-control:focus {
        border-color: #80bdff;
        box-shadow: 0 0 5px rgba(0, 123, 255, 0.25);
    }
</style>


<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
<div class="container mt-5 pt-5">
    <div class="text-center mb-4">
        <button class="btn btn-success btn-lg" data-bs-toggle="modal" data-bs-target="#createVacancyModal">
            <i class="bi bi-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é
        </button>
    </div>

    <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ -->
    <div class="row mb-4">
        <div class="col-md-12">
            <input type="text" class="form-control form-control-lg" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –≤–∞–∫–∞–Ω—Å–∏–π...">
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –≤–∞–∫–∞–Ω—Å–∏–π -->
    <div id="vacancyList" class="list-group">
        {% for item in items %}
            <div class="list-group-item list-group-item-action mb-3 vacancy-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h5 class="text-primary vacancy-title">{{ item.title }}</h5>
                        <p class="mb-1"><strong>–û–ø—ã—Ç:</strong> <span class="vacancy-experience">{{ item.experience }}</span></p>
                        <p class="mb-1"><strong>–ù–∞–≤—ã–∫–∏:</strong> <span class="vacancy-skills">{{ item.skills }}</span></p>
                        <p class="mb-1"><strong>–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</strong> <span class="vacancy-education">{{ item.education }}</span></p>
                    </div>
                    <div>
                        <button class="btn btn-sm btn-outline-secondary me-2 edit-button" data-bs-toggle="modal" data-bs-target="#editVacancyModal" data-id="{{ item._id }}">
                            <i class="bi bi-pencil"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger delete-button" data-id="{{ item._id }}">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

 <!--–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ -->
<div class="modal fade" id="createVacancyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" >
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–°–æ–∑–¥–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createVacancyForm">
                    <div class="mb-3">
                        <input type="text" name="title" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏" required>
                    </div>
                    <div class="mb-3">
                        <input type="text" name="experience" class="form-control" placeholder="–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã" required>
                    </div>
                    <div class="mb-3">
                        <textarea name="skills" class="form-control" placeholder="–ù–∞–≤—ã–∫–∏ –∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <input type="text" name="education" class="form-control" placeholder="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">–°–æ–∑–¥–∞—Ç—å</button>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∞–∫–∞–Ω—Å–∏–∏ -->
<div class="modal fade" id="editVacancyModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–∞–∫–∞–Ω—Å–∏—é</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editVacancyForm">
                    <input type="hidden" id="editVacancyId">
                    <div class="mb-3">
                        <input type="text" id="editTitle" class="form-control" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–∫–∞–Ω—Å–∏–∏" required>
                    </div>
                    <div class="mb-3">
                        <input type="text" id="editExperience" class="form-control" placeholder="–û–ø—ã—Ç —Ä–∞–±–æ—Ç—ã" required>
                    </div>
                    <div class="mb-3">
                        <textarea id="editSkills" class="form-control" placeholder="–ù–∞–≤—ã–∫–∏ –∏ –∫–æ–º–ø–µ—Ç–µ–Ω—Ü–∏–∏" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <input type="text" id="editEducation" class="form-control" placeholder="–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                </form>
            </div>
        </div>
    </div>
</div>




<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-danger text-white">
                <h5 class="modal-title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –≤–∞–∫–∞–Ω—Å–∏—é?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" id="confirmDeleteButton" class="btn btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>



<!-- JavaScript –¥–ª—è AJAX-–∑–∞–ø—Ä–æ—Å–∞ -->
<script>
     let currentVacancyId = null;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
    document.querySelectorAll('.edit-button').forEach(button => {
        button.addEventListener('click', function () {
            currentVacancyId = this.getAttribute('data-id');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–∞–∫–∞–Ω—Å–∏–∏ —á–µ—Ä–µ–∑ AJAX-–∑–∞–ø—Ä–æ—Å
            fetch(`/get_vacancy/${currentVacancyId}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('editTitle').value = data.title;
                    document.getElementById('editExperience').value = data.experience;
                    document.getElementById('editSkills').value = data.skills;
                    document.getElementById('editEducation').value = data.education;

                    const editModal = new bootstrap.Modal(document.getElementById('editVacancyModal'));
                    editModal.show();
                })
                .catch(error => {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error);
                });
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    document.getElementById('editVacancyForm').addEventListener('submit', function (event) {
        event.preventDefault();

        const vacancyId = currentVacancyId;
        const title = document.getElementById('editTitle').value;
        const experience = document.getElementById('editExperience').value;
        const skills = document.getElementById('editSkills').value;
        const education = document.getElementById('editEducation').value;

        fetch(`/update_vacancy/${vacancyId}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                title: title,
                experience: experience,
                skills: skills,
                education: education
            }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Bootstrap API
                const editModal = bootstrap.Modal.getInstance(document.getElementById('editVacancyModal'));
                editModal.hide();

                // –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è –æ–≤–µ—Ä–ª–µ–π –≤—Ä—É—á–Ω—É—é, –µ—Å–ª–∏ –æ–Ω –æ—Å—Ç–∞—ë—Ç—Å—è
                const backdrop = document.querySelector('.modal-backdrop');
                if (backdrop) backdrop.remove();

                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ –≤–∞–∫–∞–Ω—Å–∏–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
                const vacancyCard = document.querySelector(`[data-id="${vacancyId}"]`).closest('.list-group-item');
                vacancyCard.querySelector('.vacancy-title').textContent = title;
                vacancyCard.querySelector('.vacancy-experience').textContent = experience;
                vacancyCard.querySelector('.vacancy-skills').textContent = skills;
                vacancyCard.querySelector('.vacancy-education').textContent = education;
            } else {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', data.message);
            }
        })
        .catch(error => {
            console.error('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:', error);
        });
    });

    // –û—á–∏—Å—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∏ —É–¥–∞–ª–µ–Ω–∏–µ –æ–≤–µ—Ä–ª–µ—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    const editVacancyModal = document.getElementById('editVacancyModal');
    editVacancyModal.addEventListener('hidden.bs.modal', () => {
        document.getElementById('editVacancyForm').reset();
        currentVacancyId = null;

        // –£–¥–∞–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è –æ–≤–µ—Ä–ª–µ–π –≤—Ä—É—á–Ω—É—é
        const backdrop = document.querySelector('.modal-backdrop');
        if (backdrop) backdrop.remove();
    });


let deleteVacancyId = null;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è
    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', function () {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID –≤–∞–∫–∞–Ω—Å–∏–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
            deleteVacancyId = this.getAttribute('data-id');
            const confirmDeleteModal = new bootstrap.Modal(document.getElementById('confirmDeleteModal'));
            confirmDeleteModal.show();
        });
    });

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
    document.getElementById('confirmDeleteButton').addEventListener('click', function () {
        if (deleteVacancyId) {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º DELETE-–∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch(`/delete_vacancy/${deleteVacancyId}`, {
                method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    // –£–¥–∞–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤–∞–∫–∞–Ω—Å–∏–∏ –∏–∑ DOM
                    document.querySelector(`[data-id="${deleteVacancyId}"]`).closest('.list-group-item').remove();
                } else {
                    alert('–û—à–∏–±–∫–∞: ' + data.message);
                }
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                const confirmDeleteModal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
                confirmDeleteModal.hide();
            })
            .catch(error => {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏: ' + error);
                const confirmDeleteModal = bootstrap.Modal.getInstance(document.getElementById('confirmDeleteModal'));
                confirmDeleteModal.hide();
            });
        }
    });



    document.getElementById('createVacancyForm').addEventListener('submit', function(event) {
        event.preventDefault();
        const formData = new FormData(this);

        fetch('/create_vacancy', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {

                location.reload(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –≤–∞–∫–∞–Ω—Å–∏–π
            } else {
                alert(data.message);
            }
        })
        .catch(error => {
            alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: ' + error);
        });
    });



<!-- JavaScript –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤–∞–∫–∞–Ω—Å–∏–π -->

    document.getElementById('searchInput').addEventListener('input', function() {
        const query = this.value.toLowerCase();
        const vacancies = document.querySelectorAll('#vacancyList .list-group-item');

        vacancies.forEach(function(vacancy) {
            const title = vacancy.querySelector('.vacancy-title').textContent.toLowerCase();
            const experience = vacancy.querySelector('.vacancy-experience').textContent.toLowerCase();
            const skills = vacancy.querySelector('.vacancy-skills').textContent.toLowerCase();
            const education = vacancy.querySelector('.vacancy-education').textContent.toLowerCase();

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ —Ç–µ–∫—Å—Ç –≤–∞–∫–∞–Ω—Å–∏–∏ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            if (title.includes(query) || experience.includes(query) || skills.includes(query) || education.includes(query)) {
                vacancy.style.display = 'block';
            } else {
                vacancy.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}
